$dirToRemoveAccess = Read-Host "Insert directory name"
$dirtable = Get-ChildItem $dirToRemoveAccess
$groupsToRemoveAccess = Read-Host "insert group name"
if ($groupsToRemoveAccess.Contains(','))
{
    $groupsToRemoveAccessTable = $groupsToRemoveAccess -split ','
}
else
{
    $groupsToRemoveAccessTable = $groupsToRemoveAccess
}
foreach($name in (Get-ChildItem $dirToRemoveAccess).FullName) 
{
    if (Test-Path -Path $name -PathType Container)
        {
            foreach ($group in $groupsToRemoveAccessTable)
            {
                icacls $name /inheritance:d 
                $acl = Get-Acl $name
                $acl.Access | Where-Object { $_.IdentityReference.Value -eq $Group } | ForEach-Object {$acl.RemoveAccessRule($_)}
                Set-Acl -Path $name -AclObject $acl
            }
        }
}
