$dirToRemoveAccess = Read-Host "Wprowadź ścieżkę"
$dirtable = Get-ChildItem $dirToRemoveAccess
$groupsToRemoveAccess = Read-Host "Wprowadź nazwę grupy (jeżeli wprowadzasz wiele grup oddziel je przecinkami)"
if ($dirToRemoveAccess -match '\\\\([^\\]+)\\') {
    $value = $matches[1] + "\"
}
else 
{
    $value = "example\"
}
if ($groupsToRemoveAccess.Contains(' '))
{
    $groupsToRemoveAccessTable = $groupsToRemoveAccess -split ' '
}
else
{
    $groupsToRemoveAccessTable = $groupsToRemoveAccess
}
foreach($name in (Get-ChildItem $dirToRemoveAccess).FullName) 
{
    if (Test-Path -Path $name -PathType Container)
    {
        foreach ($group in $groupsToRemoveAccessTable)
        {
            $groupWithPrefix = $value + $group
            $groupWithPrefix
            icacls $name /inheritance:d 
            $acl = Get-Acl $name
            $acl.Access | Where-Object { $_.IdentityReference.Value -eq $groupWithPrefix } | ForEach-Object {$acl.RemoveAccessRule($_)}
            Set-Acl -Path $name -AclObject $acl
        }
    }
}
